#!/bin/bash

XMTO="1"
XDTO="$(( XMTO * 1000 ))"

# Xdialog/dialog
export XDIALOG_HIGH_DIALOG_COMPAT=1 XDIALOG_FORCE_AUTOSIZE=1 XDIALOG_INFOBOX_TIMEOUT="${XDTO}" XDIALOG_NO_GMSGS=1 \
       DIALOG_OK=0 DIALOG_CANCEL=1 DIALOG_HELP=2 DIALOG_EXTRA=3 DIALOG_ITEM_HELP=4 DIALOG_ESC=255 \
       SIG_NONE=0 SIG_HUP=1 SIG_INT=2 SIG_QUIT=3 SIG_KILL=9 SIG_TERM=15

# Pick a default available UI ...
#shellcheck disable=SC2155
if [[ -x $(type -P Xdialog 2> /dev/null) && -n "${DISPLAY}" ]]; then # Check for X, Xdialog
    declare DIALOG="$(command -v Xdialog)" G=( "0" "0" "${XDTO}" )
elif [[ -x $(type -P dialog 2> /dev/null) ]]; then # Check for dialog
    declare DIALOG="$(command -v dialog)" G=( "0" "0" )
fi

display_feedback() {
    notify-send "${*}" 2> /dev/null && echo -ne "${*}\n" >&2 && return
    ${DIALOG} "--title" "Vol" "--infobox" "${*}" "${G[@]}" 2> /dev/null && echo -ne "${*}\n" >&2 && return
    xmessage -nearmouse -timeout "${XMTO}" "${*}" 2> /dev/null && echo -ne "${*}\n" >&2 && return
    echo -ne "${*}\n" >&2
}

usage() {
    display_feedback "Usage: $(basename "${BASH_SOURCE[0]}") [+]|[-]|[0-100]|report"
    exit 1
}

#shellcheck disable=SC2015
case "${1}" in
    +|-) VOL="$(amixer sset Master "5dB${1}")";;
    *[0-9]) [[ "${1}" =~ ^[0-9]{1,3}$ ]] && (( $1 >= 0 && $1 <= 100 )) && VOL="$(amixer sset Master "${1}%")" || usage;;
    report) VOL="$(amixer sget Master)";;
    *) usage ;;
esac

VOL="${VOL/\]*}"

VOL="${VOL/*\[}"

display_feedback "Master: ${VOL}"
