#!/bin/bash

export XDIALOG_NO_GMSGS=1

# Pick a default available UI ...
if [[ -x $(type -P Xdialog 2> /dev/null) && -n "${DISPLAY}" ]]; then # Check for X, Xdialog
    declare DIALOG="$(type -P Xdialog)" G=( 0 0 1000 )
elif [[ -x $(type -P dialog 2> /dev/null) ]]; then # Check for dialog
    declare DIALOG="$(type -P dialog)" G=( 0 0 )
fi

usage() {
    echo -ne "Usage: vol [+]|[-]|[0-100]|report\n" >&2
    exit 1
}

case "${1}" in
    +|-) VOL=$(amixer sset Master "5dB${1}") ;;
    *[0-9]) [[ "${1}" =~ ^[0-9]{1,3}$ ]] && VOL=$(amixer sset Master "${1}%") || usage ;;
    "report") VOL=$(amixer sget Master) ;;
    *) usage ;;
esac

VOL=${VOL/\]*}

VOL=${VOL/*\[}

notify-send "Master: ${VOL}" 2> /dev/null || \
    ${DIALOG} --title "Vol" --infobox "Master: ${VOL}" "${G[@]}" 2> /dev/null || \
    xmessage -nearmouse -timeout 1 "Master: ${VOL}" 2> /dev/null || \
    echo "Master: ${VOL}"
